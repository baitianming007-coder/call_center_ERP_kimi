# å‘¼å«ä¸­å¿ƒç³»ç»Ÿ - æ–°åŠŸèƒ½å¼€å‘æŠ¥å‘Š

**ç‰ˆæœ¬**: 2.0  
**æ—¥æœŸ**: 2025-10-15  
**å¼€å‘çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œå‰ç«¯æ¨¡æ¿å¾…å¼€å‘

---

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

æœ¬æ¬¡å¼€å‘åŒ…å«ä¸¤ä¸ªé‡å¤§éœ€æ±‚ï¼š

### éœ€æ±‚1ï¼šæ™‹çº§ç¡®è®¤ + ä¿çº§æŒ‘æˆ˜ç®¡ç†ç³»ç»Ÿ
- **æ™‹çº§ç¡®è®¤è§„åˆ™**ï¼šåŸ¹è®­æœŸâ†’Cã€Câ†’Bã€Bâ†’Aï¼Œéœ€è¦é‡åŒ–æŒ‡æ ‡+ä¸»ç®¡ç¡®è®¤
- **ä¿çº§æŒ‘æˆ˜æœºåˆ¶**ï¼šAçº§å‘˜å·¥ä¸šç»©ä¸‹æ»‘æ—¶çš„ä¿çº§æµç¨‹
- **å·¥ä½œæ—¥è®¡ç®—**ï¼šç®¡ç†å‘˜è‡ªå®šä¹‰å·¥ä½œæ—¥é…ç½®
- **æ“ä½œæ—¥å¿—**ï¼šå®Œæ•´çš„å®¡è®¡è¿½è¸ª

### éœ€æ±‚2ï¼šå·¥èµ„ç®¡ç†ç³»ç»Ÿ
- **å·¥èµ„å•ç”Ÿæˆ**ï¼šä»salaryè¡¨åŒæ­¥ï¼Œæ”¯æŒè¦†ç›–
- **å·¥èµ„è°ƒæ•´**ï¼šæ‰£æ¬¾/è¡¥è´´åŠŸèƒ½ï¼Œæƒé™éš”ç¦»
- **å‘æ”¾ç®¡ç†**ï¼šè´¢åŠ¡è§’è‰²ï¼Œå¤šç§å‘æ”¾æ–¹å¼
- **å¹´åº¦å½’æ¡£**ï¼šå†å²æ•°æ®å½’æ¡£æŸ¥è¯¢

---

## âœ… å·²å®ŒæˆåŠŸèƒ½æ¸…å•

### ğŸ—„ï¸ 1. æ•°æ®åº“è®¾è®¡ï¼ˆå·²å®Œæˆï¼‰

#### æ–°å¢8ä¸ªæ ¸å¿ƒè¡¨ï¼š
1. **`promotion_confirmations`** - æ™‹çº§ç¡®è®¤è®°å½•è¡¨
2. **`demotion_challenges`** - ä¿çº§æŒ‘æˆ˜è®°å½•è¡¨
3. **`training_assessments`** - åŸ¹è®­è€ƒæ ¸è®°å½•è¡¨
4. **`work_calendar`** - å·¥ä½œæ—¥é…ç½®è¡¨
5. **`audit_logs`** - æ“ä½œæ—¥å¿—è¡¨
6. **`payroll_records`** - å·¥èµ„å•è¡¨
7. **`payroll_adjustments`** - å·¥èµ„è°ƒæ•´è®°å½•è¡¨
8. **`payroll_archives`** - å¹´åº¦å½’æ¡£è¡¨

#### æ‰©å±•ç°æœ‰è¡¨ï¼š
- **`users`** è¡¨ï¼šæ–°å¢ `finance` è§’è‰²
- **`employees`** è¡¨ï¼šæ–°å¢é“¶è¡Œä¿¡æ¯å­—æ®µã€ä¿çº§æŒ‘æˆ˜å­—æ®µ
- **`notifications`** è¡¨ï¼šæ–°å¢9ç§é€šçŸ¥ç±»å‹

#### è¿ç§»è„šæœ¬ï¼š
- âœ… `migrate_database.py` - è‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“è¿ç§»
- âœ… `schema_extensions.sql` - å®Œæ•´çš„æ‰©å±•SQL

---

### âš™ï¸ 2. æ ¸å¿ƒä¸šåŠ¡å¼•æ“ï¼ˆå·²å®Œæˆï¼‰

#### ğŸ“… **å·¥ä½œæ—¥è®¡ç®—æ¨¡å—** (`core/workday.py`)
```python
æ ¸å¿ƒå‡½æ•°ï¼š
- is_workday(date) - åˆ¤æ–­æ˜¯å¦ä¸ºå·¥ä½œæ—¥
- count_workdays_between(start, end) - è®¡ç®—ä¸¤æ—¥æœŸé—´å·¥ä½œæ—¥æ•°
- get_next_workday(from_date) - è·å–ä¸‹ä¸€ä¸ªå·¥ä½œæ—¥
- get_recent_workdays(end_date, count) - è·å–æœ€è¿‘Nä¸ªå·¥ä½œæ—¥
- get_next_n_workdays(start_date, count) - è·å–æœªæ¥Nä¸ªå·¥ä½œæ—¥
- get_workdays_in_range(start, end) - è·å–åŒºé—´å†…æ‰€æœ‰å·¥ä½œæ—¥
```

**ç‰¹ç‚¹**ï¼š
- æœªé…ç½®æ—¥æœŸé»˜è®¤ä¸ºå·¥ä½œæ—¥
- æ”¯æŒç®¡ç†å‘˜è‡ªå®šä¹‰é…ç½®
- é«˜æ•ˆçš„æ—¥æœŸè®¡ç®—ç®—æ³•

---

#### ğŸ“ˆ **æ™‹çº§ç¡®è®¤å¼•æ“** (`core/promotion_engine.py`)

```python
æ ¸å¿ƒå‡½æ•°ï¼š
- check_trainee_to_c_eligible() - æ£€æŸ¥åŸ¹è®­æœŸâ†’Cçº§èµ„æ ¼
- check_c_to_b_eligible() - æ£€æŸ¥Câ†’Bçº§èµ„æ ¼
- check_b_to_a_eligible() - æ£€æŸ¥Bâ†’Açº§èµ„æ ¼
- trigger_promotion_confirmation() - è§¦å‘æ™‹çº§ç¡®è®¤æµç¨‹
- approve_promotion() - æ‰¹å‡†æ™‹çº§
- reject_promotion() - é©³å›æ™‹çº§
- override_promotion() - ç®¡ç†å‘˜å¦å†³
- check_all_employees_for_promotion() - æ‰¹é‡æ£€æŸ¥ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
```

**æ™‹çº§è§„åˆ™**ï¼š

| æ™‹çº§è·¯å¾„ | é‡åŒ–æ¡ä»¶ | é¢å¤–è¦æ±‚ | ä¸»ç®¡ç¡®è®¤ | ç”Ÿæ•ˆæ—¶é—´ |
|---------|---------|---------|---------|---------|
| åŸ¹è®­æœŸâ†’C | å…¥èŒâ‰¥3å·¥ä½œæ—¥ | åŸ¹è®­è€ƒæ ¸é€šè¿‡ | ç»ç†ç¡®è®¤ | æ¬¡å·¥ä½œæ—¥ |
| Câ†’B | Cçº§â‰¤6å·¥ä½œæ—¥ + æœ€è¿‘3æ—¥â‰¥3å• | æ—  | ç»ç†ç¡®è®¤ | æ¬¡å·¥ä½œæ—¥ |
| Bâ†’A | Bçº§â‰¤9å·¥ä½œæ—¥ + æœ€è¿‘6æ—¥â‰¥12å• | æ—  | ç»ç†ç¡®è®¤ | æ¬¡å·¥ä½œæ—¥ |

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… æ— æ—¶é—´é™åˆ¶å®¡æ‰¹ï¼ˆæé†’æŒç»­å­˜åœ¨ï¼‰
- âœ… ç®¡ç†å‘˜å¯å¦å†³ä»»ä½•å®¡æ‰¹
- âœ… å®Œæ•´çš„é€šçŸ¥æµç¨‹
- âœ… å®¡è®¡æ—¥å¿—è®°å½•

---

#### ğŸ† **ä¿çº§æŒ‘æˆ˜å¼•æ“** (`core/challenge_engine.py`)

```python
æ ¸å¿ƒå‡½æ•°ï¼š
- check_a_level_demotion_alert() - æ£€æŸ¥Açº§é™çº§é¢„è­¦
- trigger_demotion_alert() - è§¦å‘é™çº§é¢„è­¦
- make_challenge_decision() - ç»ç†å†³ç­–ï¼ˆé™çº§/æŒ‘æˆ˜/å–æ¶ˆï¼‰
- check_challenge_completion() - æ£€æŸ¥æŒ‘æˆ˜è¿›åº¦
- finalize_challenge() - å®ŒæˆæŒ‘æˆ˜ï¼ˆç¡®è®¤ç»“æœï¼‰
- batch_check_challenges() - æ‰¹é‡æ£€æŸ¥è¿›è¡Œä¸­æŒ‘æˆ˜
```

**ä¿çº§è§„åˆ™**ï¼š

1. **è§¦å‘æ¡ä»¶**ï¼šæœ€è¿‘6ä¸ªå·¥ä½œæ—¥å‡ºå•â‰¤12å•
2. **ä¸»ç®¡å†³ç­–**ï¼ˆæ— æ—¶é—´é™åˆ¶ï¼‰ï¼š
   - ç›´æ¥é™çº§ï¼šé™ä¸ºCçº§ï¼Œæ¬¡å·¥ä½œæ—¥ç”Ÿæ•ˆ
   - ä¿çº§æŒ‘æˆ˜ï¼šå¯åŠ¨3ä¸ªå·¥ä½œæ—¥æŒ‘æˆ˜æœŸ
   - å–æ¶ˆé¢„è­¦ï¼šæ¢å¤æ­£å¸¸è¯„ä¼°

3. **æŒ‘æˆ˜æœŸè§„åˆ™**ï¼š
   - å‘¨æœŸï¼š3ä¸ªå·¥ä½œæ—¥
   - ç›®æ ‡ï¼šâ‰¥9å•
   - æˆåŠŸï¼šç»´æŒAçº§ï¼Œæ­£å¸¸è–ªèµ„
   - å¤±è´¥ï¼šé™ä¸ºCçº§ï¼ŒæŒ‘æˆ˜æœŸ30å…ƒ/å¤©ï¼ˆææˆæŒ‰Açº§ï¼‰

4. **æœˆåº¦é™åˆ¶**ï¼šæ¯æœˆæœ€å¤š1æ¬¡ä¿çº§æŒ‘æˆ˜

---

#### ğŸ’° **å·¥èµ„ç®¡ç†å¼•æ“** (`core/payroll_engine.py`)

```python
æ ¸å¿ƒå‡½æ•°ï¼š
- generate_payroll_for_month() - ç”Ÿæˆæœˆåº¦å·¥èµ„å•
- adjust_payroll() - è°ƒæ•´å·¥èµ„ï¼ˆæ‰£æ¬¾/è¡¥è´´ï¼‰
- get_payroll_adjustments() - è·å–è°ƒæ•´è®°å½•
- confirm_payroll_for_payment() - è´¢åŠ¡ç¡®è®¤
- mark_payroll_payment() - æ ‡è®°å‘æ”¾
- mark_payroll_payment_failed() - æ ‡è®°å‘æ”¾å¤±è´¥
- retry_payroll_payment() - é‡è¯•å‘æ”¾
- batch_confirm_payrolls() - æ‰¹é‡ç¡®è®¤
- archive_payroll_year() - å¹´åº¦å½’æ¡£
- get_archive_summary() - è·å–å½’æ¡£æ±‡æ€»
```

**å·¥èµ„å•æµç¨‹**ï¼š

```
pending (å¾…ç¡®è®¤) 
  â†“ ç»ç†/ç®¡ç†å‘˜è°ƒæ•´ï¼ˆå¯é€‰ï¼‰
  â†“ è´¢åŠ¡ç¡®è®¤
confirmed (å·²ç¡®è®¤ï¼Œå¾…å‘æ”¾)
  â†“ è´¢åŠ¡é€‰æ‹©å‘æ”¾æ–¹å¼
  â†“ è´¢åŠ¡æ ‡è®°å‘æ”¾çŠ¶æ€
  â”œâ”€ paid (å·²å‘æ”¾)
  â”œâ”€ failed (å¤±è´¥) â†’ retry (å¾…é‡è¯•)
  â””â”€ cancelled (å·²å–æ¶ˆ)
```

**æƒé™æ§åˆ¶**ï¼š
- ç®¡ç†å‘˜ï¼šå¯è°ƒæ•´æ‰€æœ‰äººå·¥èµ„
- ç»ç†ï¼šåªèƒ½è°ƒæ•´æœ¬å›¢é˜Ÿå·¥èµ„
- è´¢åŠ¡ï¼šåªèƒ½ç¡®è®¤å’Œå‘æ”¾ï¼Œä¸èƒ½è°ƒæ•´é‡‘é¢

---

#### ğŸ“ **æ“ä½œæ—¥å¿—ç³»ç»Ÿ** (`core/audit.py`)

```python
æ ¸å¿ƒå‡½æ•°ï¼š
- log_operation() - é€šç”¨æ—¥å¿—è®°å½•
- log_promotion_*() - æ™‹çº§ç›¸å…³æ—¥å¿—
- log_challenge_*() - ä¿çº§æŒ‘æˆ˜æ—¥å¿—
- log_training_assessment() - åŸ¹è®­è€ƒæ ¸æ—¥å¿—
- log_calendar_change() - å·¥ä½œæ—¥é…ç½®æ—¥å¿—
- log_payroll_*() - å·¥èµ„ç›¸å…³æ—¥å¿—
- log_bank_verification() - é“¶è¡Œä¿¡æ¯å®¡æ ¸æ—¥å¿—
- log_status_change() - çŠ¶æ€å˜æ›´æ—¥å¿—
- get_employee_logs() - æŸ¥è¯¢å‘˜å·¥æ—¥å¿—
- get_operator_logs() - æŸ¥è¯¢æ“ä½œäººæ—¥å¿—
- get_recent_logs() - æŸ¥è¯¢æœ€è¿‘æ—¥å¿—
```

**æ—¥å¿—å†…å®¹**ï¼š
- âœ… æ“ä½œç±»å‹ã€æ¨¡å—ã€åŠ¨ä½œ
- âœ… æ“ä½œäººä¿¡æ¯ï¼ˆIDã€å§“åã€è§’è‰²ï¼‰
- âœ… ç›®æ ‡å¯¹è±¡ï¼ˆå‘˜å·¥ã€è®°å½•IDï¼‰
- âœ… å˜æ›´å‰åå€¼
- âœ… åŸå› å’Œå¤‡æ³¨
- âœ… IPåœ°å€å’ŒUser-Agent
- âœ… æ—¶é—´æˆ³

---

### ğŸŒ 3. Webè·¯ç”±å±‚ï¼ˆå·²å®Œæˆï¼‰

#### ğŸ‘¨â€ğŸ’¼ **ç»ç†å·¥ä½œå°è·¯ç”±** (`routes/manager_routes.py`)

```python
è·¯ç”±åˆ—è¡¨ï¼š
âœ… /manager/training_assessments - åŸ¹è®­è€ƒæ ¸ç®¡ç†
âœ… /manager/training_assessments/record - å½•å…¥è€ƒæ ¸ç»“æœ
âœ… /manager/promotions - æ™‹çº§ç¡®è®¤ç®¡ç†
âœ… /manager/promotions/<id>/approve - æ‰¹å‡†æ™‹çº§
âœ… /manager/promotions/<id>/reject - é©³å›æ™‹çº§
âœ… /manager/challenges - ä¿çº§æŒ‘æˆ˜ç®¡ç†
âœ… /manager/challenges/<id>/decide - åšå‡ºå†³ç­–
âœ… /manager/challenges/<id>/finalize - å®ŒæˆæŒ‘æˆ˜
âœ… /manager/payroll - æŸ¥çœ‹æœ¬å›¢é˜Ÿå·¥èµ„
âœ… /manager/logs - æŸ¥çœ‹æ“ä½œæ—¥å¿—
âœ… /manager/api/check_promotion/<id> - æ£€æŸ¥æ™‹çº§èµ„æ ¼API
âœ… /manager/api/check_challenge/<id> - æ£€æŸ¥æŒ‘æˆ˜è¿›åº¦API
```

---

#### ğŸ‘¨â€ğŸ’» **ç®¡ç†å‘˜æ‰©å±•è·¯ç”±** (`routes/admin_extended_routes.py`)

```python
è·¯ç”±åˆ—è¡¨ï¼š
âœ… /admin/work_calendar - å·¥ä½œæ—¥é…ç½®ç®¡ç†
âœ… /admin/work_calendar/configure - é…ç½®å•ä¸ªå·¥ä½œæ—¥
âœ… /admin/work_calendar/batch - æ‰¹é‡é…ç½®å·¥ä½œæ—¥
âœ… /admin/payroll_management - å·¥èµ„ç®¡ç†ä¸»é¡µ
âœ… /admin/payroll_management/generate - ç”Ÿæˆå·¥èµ„å•
âœ… /admin/payroll_management/<id>/adjust - è°ƒæ•´å·¥èµ„
âœ… /admin/payroll_archive - å¹´åº¦å½’æ¡£ç®¡ç†
âœ… /admin/payroll_archive/create - åˆ›å»ºå½’æ¡£
âœ… /admin/payroll_archive/<year> - æŸ¥çœ‹å½’æ¡£è¯¦æƒ…
âœ… /admin/bank_verification - é“¶è¡Œä¿¡æ¯å®¡æ ¸
âœ… /admin/bank_verification/<id>/verify - å®¡æ ¸é“¶è¡Œä¿¡æ¯
âœ… /admin/api/workday/check/<date> - æ£€æŸ¥å·¥ä½œæ—¥API
âœ… /admin/api/workday/count - è®¡ç®—å·¥ä½œæ—¥æ•°API
```

---

#### ğŸ’³ **è´¢åŠ¡å·¥ä½œå°è·¯ç”±** (`routes/finance_routes.py`)

```python
è·¯ç”±åˆ—è¡¨ï¼š
âœ… /finance/dashboard - è´¢åŠ¡å·¥ä½œå°ä¸»é¡µ
âœ… /finance/confirm/<id> - ç¡®è®¤å·¥èµ„å•
âœ… /finance/batch_confirm - æ‰¹é‡ç¡®è®¤å·¥èµ„å•
âœ… /finance/payment/<id> - å·¥èµ„å‘æ”¾é¡µé¢
âœ… /finance/mark_failed/<id> - æ ‡è®°å‘æ”¾å¤±è´¥
âœ… /finance/retry/<id> - é‡è¯•å‘æ”¾
âœ… /finance/payment_history - å‘æ”¾å†å²è®°å½•
âœ… /finance/bank_audit - é“¶è¡Œä¿¡æ¯å®¡æ ¸
âœ… /finance/bank_audit/<id>/verify - å®¡æ ¸é“¶è¡Œä¿¡æ¯
âœ… /finance/api/payroll/<id> - è·å–å·¥èµ„å•è¯¦æƒ…API
âœ… /finance/api/stats/<year_month> - è·å–æœˆåº¦ç»Ÿè®¡API
```

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Webå±‚ (Flask)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Manager Routesâ”‚  â”‚ Admin Routes â”‚  â”‚Finance Routesâ”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       ä¸šåŠ¡é€»è¾‘å±‚ (Core)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  promotion_engine  â”‚  challenge_engine  â”‚ payroll   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  workday  â”‚  audit  â”‚  notifications  â”‚  auth       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      æ•°æ®è®¿é—®å±‚ (Database)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              SQLite (8ä¸ªæ–°è¡¨ + æ‰©å±•ç°æœ‰è¡¨)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ•°æ®æµç¤ºä¾‹

### æ™‹çº§æµç¨‹ï¼š
```
å‘˜å·¥è¾¾æ ‡ â†’ ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹ â†’ åˆ›å»ºæ™‹çº§è®°å½• â†’ 
é€šçŸ¥ç»ç† â†’ ç»ç†å®¡æ‰¹ â†’ æ›´æ–°å‘˜å·¥çŠ¶æ€ â†’ 
è®°å½•æ—¥å¿— â†’ é€šçŸ¥å‘˜å·¥
```

### ä¿çº§æŒ‘æˆ˜æµç¨‹ï¼š
```
Açº§å‘˜å·¥ä¸šç»©ä¸‹æ»‘ â†’ ç³»ç»Ÿè§¦å‘é¢„è­¦ â†’ é€šçŸ¥ç»ç† â†’ 
ç»ç†å†³ç­–ï¼ˆé™çº§/æŒ‘æˆ˜/å–æ¶ˆï¼‰â†’ 
  [æŒ‘æˆ˜] â†’ 3å¤©æŒ‘æˆ˜æœŸ â†’ ç»Ÿè®¡å‡ºå• â†’ 
  åˆ¤å®šç»“æœ â†’ æ›´æ–°çŠ¶æ€ â†’ ç‰¹æ®Šè–ªèµ„è®¡ç®—
```

### å·¥èµ„å•æµç¨‹ï¼š
```
ç®¡ç†å‘˜ç”Ÿæˆå·¥èµ„å• â†’ ä»salaryè¡¨åŒæ­¥ â†’ 
ç»ç†è°ƒæ•´ï¼ˆå¯é€‰ï¼‰â†’ è´¢åŠ¡ç¡®è®¤ â†’ 
è´¢åŠ¡å‘æ”¾ â†’ çŠ¶æ€æ›´æ–° â†’ è®°å½•æ—¥å¿—
```

---

## ğŸ” æƒé™çŸ©é˜µ

| åŠŸèƒ½æ¨¡å— | å‘˜å·¥ | ç»ç† | ç®¡ç†å‘˜ | è´¢åŠ¡ |
|---------|------|------|--------|------|
| åŸ¹è®­è€ƒæ ¸å½•å…¥ | âŒ | âœ… æœ¬å›¢é˜Ÿ | âœ… å…¨éƒ¨ | âŒ |
| æ™‹çº§å®¡æ‰¹ | âŒ | âœ… æœ¬å›¢é˜Ÿ | âœ… å…¨éƒ¨+å¦å†³ | âŒ |
| ä¿çº§å†³ç­– | âŒ | âœ… æœ¬å›¢é˜Ÿ | âœ… å…¨éƒ¨ | âŒ |
| å·¥ä½œæ—¥é…ç½® | âŒ | âŒ | âœ… | âŒ |
| å·¥èµ„å•ç”Ÿæˆ | âŒ | âŒ | âœ… | âŒ |
| å·¥èµ„è°ƒæ•´ | âŒ | âœ… æœ¬å›¢é˜Ÿ | âœ… å…¨éƒ¨ | âŒ |
| å·¥èµ„å‘æ”¾ | âŒ | âŒ | âŒ | âœ… |
| é“¶è¡Œå®¡æ ¸ | âŒ | âŒ | âœ… | âœ… |
| å¹´åº¦å½’æ¡£ | âŒ | âŒ | âœ… | âŒ |
| æ“ä½œæ—¥å¿— | âŒ | âœ… è‡ªå·± | âœ… å…¨éƒ¨ | âŒ |

---

## ğŸ¨ å¾…å®Œæˆå·¥ä½œ

### â— é‡è¦ï¼šå‰ç«¯æ¨¡æ¿å¼€å‘

ç”±äºå‰ç«¯HTMLæ¨¡æ¿æ•°é‡å¤šã€å¤æ‚åº¦é«˜ï¼Œéœ€è¦å•ç‹¬å¼€å‘ã€‚ä»¥ä¸‹æ˜¯éœ€è¦åˆ›å»ºçš„æ¨¡æ¿åˆ—è¡¨ï¼š

#### ç»ç†å·¥ä½œå°æ¨¡æ¿ï¼š
1. `templates/manager/training_assessments.html` - åŸ¹è®­è€ƒæ ¸é¡µé¢
2. `templates/manager/promotions.html` - æ™‹çº§å®¡æ‰¹é¡µé¢
3. `templates/manager/challenges.html` - ä¿çº§æŒ‘æˆ˜é¡µé¢
4. `templates/manager/payroll.html` - å·¥èµ„æŸ¥çœ‹é¡µé¢
5. `templates/manager/logs.html` - æ“ä½œæ—¥å¿—é¡µé¢

#### ç®¡ç†å‘˜æ¨¡æ¿ï¼š
6. `templates/admin/work_calendar.html` - å·¥ä½œæ—¥é…ç½®é¡µé¢
7. `templates/admin/payroll_management.html` - å·¥èµ„ç®¡ç†é¡µé¢
8. `templates/admin/payroll_archive.html` - å¹´åº¦å½’æ¡£é¡µé¢
9. `templates/admin/payroll_archive_detail.html` - å½’æ¡£è¯¦æƒ…é¡µé¢
10. `templates/admin/bank_verification.html` - é“¶è¡Œä¿¡æ¯å®¡æ ¸é¡µé¢

#### è´¢åŠ¡å·¥ä½œå°æ¨¡æ¿ï¼š
11. `templates/finance/dashboard.html` - è´¢åŠ¡å·¥ä½œå°ä¸»é¡µ
12. `templates/finance/payment.html` - å·¥èµ„å‘æ”¾é¡µé¢
13. `templates/finance/payment_history.html` - å‘æ”¾å†å²é¡µé¢
14. `templates/finance/bank_audit.html` - é“¶è¡Œå®¡æ ¸é¡µé¢

#### å…¬å…±ç»„ä»¶ï¼ˆå¯é€‰ï¼‰ï¼š
15. `templates/components/promotion_card.html` - æ™‹çº§å¡ç‰‡ç»„ä»¶
16. `templates/components/challenge_card.html` - æŒ‘æˆ˜å¡ç‰‡ç»„ä»¶
17. `templates/components/payroll_table.html` - å·¥èµ„è¡¨æ ¼ç»„ä»¶
18. `templates/components/calendar_grid.html` - æ—¥å†ç½‘æ ¼ç»„ä»¶

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### 1. å•å…ƒæµ‹è¯•ï¼ˆæ ¸å¿ƒå¼•æ“ï¼‰
```bash
# æµ‹è¯•å·¥ä½œæ—¥è®¡ç®—
python3 -c "from core.workday import *; print(is_workday('2025-10-15'))"

# æµ‹è¯•æ™‹çº§æ£€æµ‹
python3 -c "from core.promotion_engine import check_trainee_to_c_eligible; print(check_trainee_to_c_eligible(1))"

# æµ‹è¯•ä¿çº§æ£€æµ‹
python3 -c "from core.challenge_engine import check_a_level_demotion_alert; print(check_a_level_demotion_alert(1))"
```

### 2. é›†æˆæµ‹è¯•ï¼ˆå®Œæ•´æµç¨‹ï¼‰
#### æµ‹è¯•åœºæ™¯1ï¼šåŸ¹è®­æœŸâ†’Cçº§æ™‹çº§
1. åˆ›å»ºåŸ¹è®­æœŸå‘˜å·¥
2. å½•å…¥åŸ¹è®­è€ƒæ ¸ç»“æœï¼ˆé€šè¿‡ï¼‰
3. ç­‰å¾…3ä¸ªå·¥ä½œæ—¥
4. è§¦å‘æ™‹çº§ç¡®è®¤
5. ç»ç†æ‰¹å‡†
6. éªŒè¯å‘˜å·¥çŠ¶æ€å˜æ›´

#### æµ‹è¯•åœºæ™¯2ï¼šAçº§ä¿çº§æŒ‘æˆ˜
1. åˆ›å»ºAçº§å‘˜å·¥
2. å½•å…¥æœ€è¿‘6å¤©ä¸šç»©ï¼ˆâ‰¤12å•ï¼‰
3. è§¦å‘é™çº§é¢„è­¦
4. ç»ç†é€‰æ‹©"ä¿çº§æŒ‘æˆ˜"
5. å½•å…¥3å¤©æŒ‘æˆ˜æœŸä¸šç»©
6. å®ŒæˆæŒ‘æˆ˜ï¼ŒéªŒè¯ç»“æœ

#### æµ‹è¯•åœºæ™¯3ï¼šå·¥èµ„ç®¡ç†æµç¨‹
1. ç®¡ç†å‘˜ç”Ÿæˆ2025-10å·¥èµ„å•
2. ç»ç†è°ƒæ•´æœ¬å›¢é˜Ÿå·¥èµ„ï¼ˆæ‰£æ¬¾50å…ƒï¼‰
3. è´¢åŠ¡æ‰¹é‡ç¡®è®¤
4. è´¢åŠ¡å‘æ”¾ï¼ˆé“¶è¡Œè½¬è´¦ï¼‰
5. éªŒè¯çŠ¶æ€å˜æ›´å’Œæ—¥å¿—

### 3. æƒé™æµ‹è¯•
- âœ… ç»ç†åªèƒ½çœ‹åˆ°æœ¬å›¢é˜Ÿæ•°æ®
- âœ… ç»ç†ä¸èƒ½è°ƒæ•´å…¶ä»–å›¢é˜Ÿå·¥èµ„
- âœ… è´¢åŠ¡ä¸èƒ½è°ƒæ•´å·¥èµ„é‡‘é¢
- âœ… ç®¡ç†å‘˜å¯ä»¥å¦å†³ä»»ä½•å®¡æ‰¹

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æ•°æ®åº“ç´¢å¼•ï¼ˆå·²æ·»åŠ ï¼‰
- âœ… `idx_promotion_status` - æ™‹çº§è®°å½•çŠ¶æ€ç´¢å¼•
- âœ… `idx_challenge_status` - æŒ‘æˆ˜è®°å½•çŠ¶æ€ç´¢å¼•
- âœ… `idx_payroll_month` - å·¥èµ„å•æœˆä»½ç´¢å¼•
- âœ… `idx_audit_operator` - æ—¥å¿—æ“ä½œäººç´¢å¼•
- âœ… `idx_work_calendar_date` - å·¥ä½œæ—¥æ—¥æœŸç´¢å¼•

### ç¼“å­˜ç­–ç•¥ï¼ˆå¾…å®ç°ï¼‰
- å·¥ä½œæ—¥é…ç½®ç¼“å­˜ï¼ˆå‡å°‘æ•°æ®åº“æŸ¥è¯¢ï¼‰
- æ™‹çº§è§„åˆ™é…ç½®ç¼“å­˜
- ç”¨æˆ·æƒé™ç¼“å­˜

---

## ğŸ”„ åç»­æ‰©å±•æ–¹å‘

### Phase 3ï¼ˆå»ºè®®ï¼‰ï¼š
1. **å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ**
   - æ¯æ—¥è‡ªåŠ¨æ£€æµ‹æ™‹çº§èµ„æ ¼
   - æ¯æ—¥è‡ªåŠ¨æ£€æµ‹ä¿çº§é¢„è­¦
   - æ¯æœˆè‡ªåŠ¨ç”Ÿæˆå·¥èµ„å•

2. **æ•°æ®ç»Ÿè®¡æŠ¥è¡¨**
   - æ™‹çº§æˆåŠŸç‡ç»Ÿè®¡
   - ä¿çº§æŒ‘æˆ˜æˆåŠŸç‡ç»Ÿè®¡
   - å·¥èµ„å‘æ”¾ç»Ÿè®¡

3. **ç§»åŠ¨ç«¯é€‚é…**
   - å“åº”å¼è®¾è®¡
   - PWAæ”¯æŒ

4. **é«˜çº§æƒé™ç®¡ç†**
   - ç»†ç²’åº¦æƒé™æ§åˆ¶
   - è§’è‰²è‡ªå®šä¹‰

---

## ğŸ’¡ å…³é”®æŠ€æœ¯å†³ç­–

### 1. ä¸ºä»€ä¹ˆé€‰æ‹©SQLiteï¼Ÿ
- âœ… é›¶é…ç½®ï¼Œæ˜“äºéƒ¨ç½²
- âœ… å•æ–‡ä»¶æ•°æ®åº“ï¼Œä¾¿äºå¤‡ä»½
- âœ… è¶³å¤Ÿæ»¡è¶³ä¸­å°è§„æ¨¡å›¢é˜Ÿéœ€æ±‚
- âš ï¸ å¦‚éœ€å¹¶å‘é«˜ï¼Œå¯è¿ç§»è‡³PostgreSQL

### 2. ä¸ºä»€ä¹ˆæ— æ—¶é—´é™åˆ¶å®¡æ‰¹ï¼Ÿ
- âœ… ç¬¦åˆå®é™…ä¸šåŠ¡éœ€æ±‚
- âœ… é¿å…è‡ªåŠ¨é©³å›çš„ä¸åˆç†æ€§
- âœ… æé†’æŒç»­å­˜åœ¨ï¼Œä¸ä¼šé—æ¼

### 3. ä¸ºä»€ä¹ˆå·¥ä½œæ—¥æœªé…ç½®é»˜è®¤ä¸ºå·¥ä½œæ—¥ï¼Ÿ
- âœ… ç®€åŒ–åˆå§‹é…ç½®
- âœ… ç¬¦åˆå¤§å¤šæ•°åœºæ™¯
- âœ… ç®¡ç†å‘˜å¯éšæ—¶è°ƒæ•´

---

## ğŸ“ è”ç³»ä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥å¼€å‘ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2025-10-15

---

## âœ… ç­¾ç½²ç¡®è®¤

- [x] æ•°æ®åº“è®¾è®¡å®Œæˆ
- [x] æ ¸å¿ƒå¼•æ“å®Œæˆ
- [x] è·¯ç”±å±‚å®Œæˆ
- [ ] å‰ç«¯æ¨¡æ¿å¾…å¼€å‘
- [ ] é›†æˆæµ‹è¯•å¾…æ‰§è¡Œ
- [ ] UI/UXä¼˜åŒ–å¾…å®Œæˆ

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: å¼€å‘å‰ç«¯HTMLæ¨¡æ¿ï¼ˆ14ä¸ªé¡µé¢ï¼‰



