{% extends "base.html" %}

{% block title %}Excelå¯¼å…¥ä¸šç»© - å‘¼å«ä¸­å¿ƒç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="container">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    {% if breadcrumbs %}
    <nav class="breadcrumb" aria-label="breadcrumb">
        <ol class="breadcrumb-list">
            <li class="breadcrumb-item">
                <a href="{{ url_for('admin.dashboard') }}">ğŸ  é¦–é¡µ</a>
            </li>
            {% for item in breadcrumbs %}
            <li class="breadcrumb-item{% if loop.last %} active{% endif %}">
                {% if item.url and not loop.last %}
                <a href="{{ item.url }}">{{ item.name }}</a>
                {% else %}
                {{ item.name }}
                {% endif %}
            </li>
            {% endfor %}
        </ol>
    </nav>
    {% endif %}
    
    <div class="card">
        <div class="card-header">
            <h2>ğŸ“¥ Excelå¯¼å…¥ä¸šç»©æ•°æ®</h2>
        </div>
        <div class="card-body">
            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="alert alert-info" style="margin-bottom: var(--space-24);">
                <h4 style="margin-bottom: var(--space-12);">ğŸ“‹ å¯¼å…¥è¯´æ˜</h4>
                <ol style="margin-bottom: 0; padding-left: var(--space-20);">
                    <li><strong>ç¬¬ä¸€æ­¥</strong>: ç‚¹å‡»ä¸‹æ–¹"ä¸‹è½½æ¨¡æ¿"æŒ‰é’®ï¼Œè·å–Excelå¯¼å…¥æ¨¡æ¿</li>
                    <li><strong>ç¬¬äºŒæ­¥</strong>: æŒ‰ç…§æ¨¡æ¿æ ¼å¼å¡«å†™ä¸šç»©æ•°æ®ï¼ˆå·¥å·ã€æ—¥æœŸã€å‡ºå•æ•°ï¼‰</li>
                    <li><strong>ç¬¬ä¸‰æ­¥</strong>: é€‰æ‹©å¡«å†™å¥½çš„Excelæ–‡ä»¶ï¼Œç‚¹å‡»"å¼€å§‹å¯¼å…¥"</li>
                    <li><strong>æ³¨æ„äº‹é¡¹</strong>:
                        <ul>
                            <li>å·¥å·å¿…é¡»å­˜åœ¨ä¸”ä¸ºåœ¨èŒå‘˜å·¥</li>
                            <li>æ—¥æœŸæ ¼å¼ï¼šYYYY-MM-DDï¼ˆå¦‚2025-01-15ï¼‰</li>
                            <li>å‡ºå•æ•°å¿…é¡»ä¸º0-100çš„æ•´æ•°</li>
                            <li>å¦‚æœæŸæ—¥æœŸå·²æœ‰ä¸šç»©è®°å½•ï¼Œå°†è‡ªåŠ¨æ›´æ–°</li>
                        </ul>
                    </li>
                </ol>
            </div>
            
            <!-- ä¸‹è½½æ¨¡æ¿ -->
            <div style="margin-bottom: var(--space-32); text-align: center; padding: var(--space-24); background: var(--gray-50); border-radius: var(--radius-md);">
                <h3 style="margin-bottom: var(--space-16);">ğŸ’¾ ä¸‹è½½å¯¼å…¥æ¨¡æ¿</h3>
                <a href="{{ url_for('admin.performance_download_template') }}" class="btn btn-success btn-lg">
                    â¬‡ï¸ ä¸‹è½½Excelæ¨¡æ¿
                </a>
                <p style="margin-top: var(--space-12); color: var(--gray-600); font-size: 14px;">
                    æ¨¡æ¿åŒ…å«ç¤ºä¾‹æ•°æ®å’Œè¯¦ç»†è¯´æ˜
                </p>
            </div>
            
            <!-- å¯¼å…¥è¡¨å• -->
            <form method="POST" enctype="multipart/form-data" id="importForm">
                <div class="form-group">
                    <label class="form-label required">é€‰æ‹©Excelæ–‡ä»¶</label>
                    <input type="file" 
                           name="file" 
                           id="fileInput"
                           accept=".xlsx,.xls"
                           class="form-control"
                           required
                           onchange="handleFileSelect(this)">
                    <div class="form-help">æ”¯æŒæ ¼å¼ï¼š.xlsx, .xls</div>
                </div>
                
                <!-- æ–‡ä»¶é¢„è§ˆä¿¡æ¯ -->
                <div id="filePreview" style="display: none; margin-top: var(--space-16); padding: var(--space-16); background: var(--gray-50); border-radius: var(--radius-sm);">
                    <h4 style="margin-bottom: var(--space-8);">å·²é€‰æ‹©æ–‡ä»¶</h4>
                    <p id="fileName" style="margin: 0; color: var(--gray-700);"></p>
                    <p id="fileSize" style="margin: 4px 0 0 0; color: var(--gray-600); font-size: 14px;"></p>
                </div>
                
                <div style="margin-top: var(--space-24); display: flex; gap: var(--space-12);">
                    <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
                        ğŸ“¤ å¼€å§‹å¯¼å…¥
                    </button>
                    <a href="{{ url_for('admin.performance') }}" class="btn btn-secondary">
                        â† è¿”å›ä¸šç»©ç®¡ç†
                    </a>
                </div>
            </form>
            
            <!-- å¯¼å…¥è¿›åº¦æç¤º -->
            <div id="importProgress" style="display: none; margin-top: var(--space-24);">
                <div style="text-align: center; padding: var(--space-32);">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: var(--space-16); color: var(--gray-600);">æ­£åœ¨å¯¼å…¥æ•°æ®ï¼Œè¯·ç¨å€™...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å¯¼å…¥æç¤ºå¡ç‰‡ -->
    <div class="card" style="margin-top: var(--space-24);">
        <div class="card-header">
            <h3>ğŸ’¡ æ¸©é¦¨æç¤º</h3>
        </div>
        <div class="card-body">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-16);">
                <div>
                    <h4 style="color: var(--color-success); margin-bottom: var(--space-8);">âœ… æ•°æ®éªŒè¯</h4>
                    <p style="color: var(--gray-600); font-size: 14px; line-height: 1.6;">
                        ç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯æ¯ä¸€è¡Œæ•°æ®çš„åˆæ³•æ€§ï¼ŒåŒ…æ‹¬å·¥å·æ˜¯å¦å­˜åœ¨ã€æ—¥æœŸæ ¼å¼æ˜¯å¦æ­£ç¡®ã€å‡ºå•æ•°æ˜¯å¦åˆç†ç­‰ã€‚
                    </p>
                </div>
                <div>
                    <h4 style="color: var(--color-info); margin-bottom: var(--space-8);">ğŸ”„ è‡ªåŠ¨æ›´æ–°</h4>
                    <p style="color: var(--gray-600); font-size: 14px; line-height: 1.6;">
                        å¦‚æœæŸå‘˜å·¥æŸæ—¥æœŸå·²æœ‰ä¸šç»©è®°å½•ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ›´æ–°è¯¥è®°å½•ï¼Œæ— éœ€æ‰‹åŠ¨åˆ é™¤æ—§æ•°æ®ã€‚
                    </p>
                </div>
                <div>
                    <h4 style="color: var(--color-warning); margin-bottom: var(--space-8);">âš¡ è‡ªåŠ¨è®¡ç®—</h4>
                    <p style="color: var(--gray-600); font-size: 14px; line-height: 1.6;">
                        å¯¼å…¥æ—¶ç³»ç»Ÿä¼šæ ¹æ®å‘˜å·¥ç­‰çº§å’Œå‡ºå•æ•°è‡ªåŠ¨è®¡ç®—ææˆï¼Œæ— éœ€æ‰‹åŠ¨å¡«å†™ææˆé‡‘é¢ã€‚
                    </p>
                </div>
                <div>
                    <h4 style="color: var(--color-danger); margin-bottom: var(--space-8);">ğŸ“ è¯¦ç»†åé¦ˆ</h4>
                    <p style="color: var(--gray-600); font-size: 14px; line-height: 1.6;">
                        å¯¼å…¥å®Œæˆåä¼šæ˜¾ç¤ºè¯¦ç»†çš„å¯¼å…¥ç»“æœï¼ŒåŒ…æ‹¬æˆåŠŸæ¡æ•°ã€å¤±è´¥æ¡æ•°ä»¥åŠå…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.btn-lg {
    padding: var(--space-16) var(--space-32);
    font-size: 16px;
}
</style>

<script>
function handleFileSelect(input) {
    const file = input.files[0];
    const submitBtn = document.getElementById('submitBtn');
    const filePreview = document.getElementById('filePreview');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    
    if (file) {
        // éªŒè¯æ–‡ä»¶ç±»å‹
        const validTypes = ['.xlsx', '.xls'];
        const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
        
        if (!validTypes.includes(fileExtension)) {
            showToast('è¯·é€‰æ‹©Excelæ–‡ä»¶ï¼ˆ.xlsxæˆ–.xlsï¼‰', 'danger');
            input.value = '';
            submitBtn.disabled = true;
            filePreview.style.display = 'none';
            return;
        }
        
        // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§10MBï¼‰
        if (file.size > 10 * 1024 * 1024) {
            showToast('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB', 'danger');
            input.value = '';
            submitBtn.disabled = true;
            filePreview.style.display = 'none';
            return;
        }
        
        // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
        fileName.textContent = `ğŸ“„ ${file.name}`;
        fileSize.textContent = `å¤§å°: ${(file.size / 1024).toFixed(2)} KB`;
        filePreview.style.display = 'block';
        submitBtn.disabled = false;
    } else {
        submitBtn.disabled = true;
        filePreview.style.display = 'none';
    }
}

// è¡¨å•æäº¤å¤„ç†
document.getElementById('importForm').addEventListener('submit', function(e) {
    const fileInput = document.getElementById('fileInput');
    
    if (!fileInput.files[0]) {
        e.preventDefault();
        showToast('è¯·é€‰æ‹©è¦å¯¼å…¥çš„æ–‡ä»¶', 'warning');
        return;
    }
    
    // æ˜¾ç¤ºè¿›åº¦æç¤º
    document.getElementById('importProgress').style.display = 'block';
    document.getElementById('submitBtn').disabled = true;
    document.getElementById('submitBtn').innerHTML = '<span class="loading-inline"></span> å¯¼å…¥ä¸­...';
});
</script>
{% endblock %}


