{% extends "base.html" %}

{% block title %}收入成本分析 - 呼叫中心管理系统{% endblock %}

{% block content %}
<div class="mb-24">
    <h1 style="font-size: 28px; font-weight: 700; color: var(--gray-900); margin-bottom: var(--space-8);">
        📊 收入成本分析
    </h1>
</div>

<!-- 维度切换 -->
<div class="card mb-24">
    <div class="card-body">
        <div style="display: flex; gap: var(--space-12);">
            <a href="{{ url_for('admin.revenue_cost', dimension='daily') }}" 
               class="btn {% if dimension == 'daily' %}btn-primary{% else %}btn-secondary{% endif %}">
                按日
            </a>
            <a href="{{ url_for('admin.revenue_cost', dimension='monthly') }}" 
               class="btn {% if dimension == 'monthly' %}btn-primary{% else %}btn-secondary{% endif %}">
                按月
            </a>
            <a href="{{ url_for('admin.revenue_cost', dimension='yearly') }}" 
               class="btn {% if dimension == 'yearly' %}btn-primary{% else %}btn-secondary{% endif %}">
                按年
            </a>
        </div>
    </div>
</div>

<!-- 数据表格 -->
<div class="card mb-24">
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>周期</th>
                    <th>出单数</th>
                    <th>收入</th>
                    <th>成本</th>
                    <th>利润</th>
                    <th style="text-align: right;">利润率</th>
                </tr>
            </thead>
            <tbody>
                {% for item in data_list %}
                <tr>
                    <td><strong>{{ item.period }}</strong></td>
                    <td>{{ item.orders }}</td>
                    <td style="color: var(--color-success); font-weight: 600;">{{ item.revenue | format_currency }}</td>
                    <td style="color: var(--color-warning); font-weight: 600;">{{ item.cost | format_currency }}</td>
                    <td style="color: {% if item.profit >= 0 %}var(--color-primary){% else %}var(--color-danger){% endif %}; font-weight: 700; font-size: 16px;">
                        {{ item.profit | format_currency }}
                    </td>
                    <td style="text-align: right; color: {% if item.margin >= 0 %}var(--color-success){% else %}var(--color-danger){% endif %}; font-weight: 600;">
                        {{ '%.1f%%' | format(item.margin) }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- 收入成本趋势图 -->
<div class="card">
    <div class="card-header">
        <h3>📈 收入成本趋势</h3>
    </div>
    <div class="card-body">
        <canvas id="revenueChart" height="80"></canvas>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const ctx = document.getElementById('revenueChart').getContext('2d');
    const data = {{ data_list | tojson }};
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.map(d => d.period),
            datasets: [
                {
                    label: '收入',
                    data: data.map(d => d.revenue),
                    borderColor: 'rgba(16, 185, 129, 1)',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.3,
                    pointRadius: 3
                },
                {
                    label: '成本',
                    data: data.map(d => d.cost),
                    borderColor: 'rgba(245, 158, 11, 1)',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.3,
                    pointRadius: 3
                },
                {
                    label: '利润',
                    data: data.map(d => d.profit),
                    borderColor: 'rgba(37, 99, 235, 1)',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.3,
                    pointRadius: 4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(229, 231, 235, 1)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
</script>
{% endblock %}



