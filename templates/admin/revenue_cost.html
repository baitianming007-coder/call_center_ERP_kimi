{% extends "base.html" %}

{% block title %}æ”¶å…¥æˆæœ¬åˆ†æ - å‘¼å«ä¸­å¿ƒç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="mb-24">
    <h1 style="font-size: 28px; font-weight: 700; color: var(--gray-900); margin-bottom: var(--space-8);">
        ğŸ“Š æ”¶å…¥æˆæœ¬åˆ†æ
    </h1>
</div>

<!-- ç»´åº¦åˆ‡æ¢ -->
<div class="card mb-24">
    <div class="card-body">
        <div style="display: flex; gap: var(--space-12);">
            <a href="{{ url_for('admin.revenue_cost', dimension='daily') }}" 
               class="btn {% if dimension == 'daily' %}btn-primary{% else %}btn-secondary{% endif %}">
                æŒ‰æ—¥
            </a>
            <a href="{{ url_for('admin.revenue_cost', dimension='monthly') }}" 
               class="btn {% if dimension == 'monthly' %}btn-primary{% else %}btn-secondary{% endif %}">
                æŒ‰æœˆ
            </a>
            <a href="{{ url_for('admin.revenue_cost', dimension='yearly') }}" 
               class="btn {% if dimension == 'yearly' %}btn-primary{% else %}btn-secondary{% endif %}">
                æŒ‰å¹´
            </a>
        </div>
    </div>
</div>

<!-- æ•°æ®è¡¨æ ¼ -->
<div class="card mb-24">
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>å‘¨æœŸ</th>
                    <th>å‡ºå•æ•°</th>
                    <th>æ”¶å…¥</th>
                    <th>æˆæœ¬</th>
                    <th>åˆ©æ¶¦</th>
                    <th style="text-align: right;">åˆ©æ¶¦ç‡</th>
                </tr>
            </thead>
            <tbody>
                {% for item in data_list %}
                <tr>
                    <td><strong>{{ item.period }}</strong></td>
                    <td>{{ item.orders }}</td>
                    <td style="color: var(--color-success); font-weight: 600;">{{ item.revenue | format_currency }}</td>
                    <td style="color: var(--color-warning); font-weight: 600;">{{ item.cost | format_currency }}</td>
                    <td style="color: {% if item.profit >= 0 %}var(--color-primary){% else %}var(--color-danger){% endif %}; font-weight: 700; font-size: 16px;">
                        {{ item.profit | format_currency }}
                    </td>
                    <td style="text-align: right; color: {% if item.margin >= 0 %}var(--color-success){% else %}var(--color-danger){% endif %}; font-weight: 600;">
                        {{ '%.1f%%' | format(item.margin) }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- æ”¶å…¥æˆæœ¬è¶‹åŠ¿å›¾ -->
<div class="card">
    <div class="card-header">
        <h3>ğŸ“ˆ æ”¶å…¥æˆæœ¬è¶‹åŠ¿</h3>
    </div>
    <div class="card-body">
        <canvas id="revenueChart" height="80"></canvas>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const ctx = document.getElementById('revenueChart').getContext('2d');
    const data = {{ data_list | tojson }};
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.map(d => d.period),
            datasets: [
                {
                    label: 'æ”¶å…¥',
                    data: data.map(d => d.revenue),
                    borderColor: 'rgba(16, 185, 129, 1)',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.3,
                    pointRadius: 3
                },
                {
                    label: 'æˆæœ¬',
                    data: data.map(d => d.cost),
                    borderColor: 'rgba(245, 158, 11, 1)',
                    backgroundColor: 'rgba(245, 158, 11, 0.1)',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.3,
                    pointRadius: 3
                },
                {
                    label: 'åˆ©æ¶¦',
                    data: data.map(d => d.profit),
                    borderColor: 'rgba(37, 99, 235, 1)',
                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.3,
                    pointRadius: 4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(229, 231, 235, 1)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
</script>
{% endblock %}



